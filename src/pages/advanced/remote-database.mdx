---
layout: ../../layouts/MainLayout.astro
---

后端项目地址：<a href="https://github.com/MinatoHikari/Doujin-Ledger-Backend" target="_blancket">Doujin-Ledger-Backend</a>

一个普通的 nestjs 项目，如有疑问也可翻阅 nestjs 文档和 prisma 文档

## 环境需求

```
nodejs 16以上
pnpm 7以上
```

## 部署

1. 拉取代码后，项目根目录下执行 `pnpm i`，在根目录下创建 `.env.local` 文件，并设置如下参数:

```
token="" // api验证密钥，必须配合https使用，http下无效
port="" // 服务运行的端口

```

2. 创建开发环境数据库 `pnpx prisma migrate dev --name [自己取个名字]` 或者创建生产环境数据库 (dev 改成 deploy)
3. 开发环境运行项目 `pnpm run start`
   或先 build `pnpm run build` 再生产模式运行 `pnpm run start:prod`
4. 在豆津账本客户端内把 api 地址设置为 `[http或https]://[你的服务器ip或域名]:[1中设置的端口(或nginx反向代理后的端口)]/`, api 密钥设置为和服务器的 `token` 一样

   例:

```
// api地址（nginx + 域名）
https://example.com/api/

// api地址（ip）
http://2.3.4.5:3000/
```

5. 如果使用 nginx 或其他服务反向代理 nestjs 服务，设置一个反向代理规则，target 指向 `http://localhost:3000/` （或 1 中设置的端口）
